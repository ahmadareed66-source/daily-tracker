<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ“… Ù…ØªØ§Ø¨Ø¹Ù€Ø© ÙŠÙˆÙ…ÙŠØ© Ù„Ù„Ø¹Ù…ÙŠÙ„</title>
<style>
  :root {
    --bg: #0d1117;
    --card: #161b22;
    --muted: #2b3138;
    --text: #e6edf3;
    --sub: #8b949e;
    --ok: #4caf50;
    --warn: #ffb74d;
    --danger: #ef5350;
    --primary: #1f6feb;
    --gradient: linear-gradient(135deg, #1f6feb, #58a6ff);
  }

  * {
    box-sizing: border-box;
    transition: all 0.25s ease;
  }

  body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto;
  }

  /* ====== Layout ====== */
  .container {
    max-width: 920px;
    margin: auto;
    padding: 22px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--muted);
    border-radius: 18px;
    padding: 20px 18px 22px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.45);
    margin-bottom: 18px;
    position: relative;
  }

  .card:hover {
    border-color: #30363d;
    transform: translateY(-2px);
  }

  h1 {
    margin: 0 0 8px;
    text-align: center;
    font-size: 1.7rem;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .subtitle {
    margin: 0;
    text-align: center;
    color: var(--sub);
    font-size: 0.95rem;
  }

  .row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
  }

  @media (max-width: 720px) {
    .row {
      grid-template-columns: 1fr;
    }
  }

  /* ====== Inputs ====== */
  label.title {
    display: block;
    margin: 10px 0 6px;
    color: #f0f0f0;
    font-weight: 700;
    font-size: 1rem;
  }

  .field,
  select,
  textarea,
  input[type="number"],
  input[type="text"] {
    width: 100%;
    background: #1c2128;
    color: #fff;
    border: 1px solid #30363d;
    border-radius: 12px;
    padding: 12px;
    font-size: 1rem;
    transition: border-color 0.3s;
  }

  .field:focus,
  select:focus,
  textarea:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 6px rgba(31, 111, 235, 0.4);
  }

  textarea {
    min-height: 84px;
    resize: vertical;
  }

  /* ====== Yes/No chips ====== */
  .yn {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .chip {
    flex: 1 1 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    background: #1c2128;
    border: 1px solid #30363d;
    border-radius: 14px;
    padding: 12px;
    cursor: pointer;
    user-select: none;
    font-weight: 600;
  }

  .chip input {
    display: none;
  }

  .chip.ok {
    border-color: rgba(76, 175, 80, 0.4);
  }

  .chip.no {
    border-color: rgba(239, 83, 80, 0.4);
  }

  .chip:has(input:checked) {
    background: var(--gradient);
    color: #fff;
    border-color: transparent;
    font-weight: 700;
    box-shadow: 0 0 10px rgba(88, 166, 255, 0.5);
    transform: scale(1.05);
  }

  /* ====== Buttons ====== */
  .btn {
    background: var(--ok);
    border: none;
    color: #fff;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 1rem;
    cursor: pointer;
    transition: 0.25s;
  }

  .btn:hover {
    filter: brightness(1.15);
    transform: translateY(-2px);
  }

  .btn.sec {
    background: var(--primary);
  }

  .btn.ghost {
    background: transparent;
    border: 1px solid #30363d;
    color: #e9e9e9;
  }

  .btn.warn {
    background: var(--warn);
  }

  .btn.danger {
    background: var(--danger);
  }

  /* ====== Water Progress ====== */
  .progress {
    height: 14px;
    background: #1a1a1a;
    border-radius: 999px;
    overflow: hidden;
    border: 1px solid #30363d;
  }

  .progress > div {
    height: 100%;
    width: 0;
    background: linear-gradient(90deg, #4caf50, #7ef48d);
    transition: width 0.35s ease;
  }

  .water-stats {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #1c2128;
    border: 1px solid #30363d;
    border-radius: 12px;
    padding: 12px;
  }

  .water-stats .big {
    font-size: 1.3rem;
    font-weight: 800;
  }

  /* ====== Table ====== */
  table {
    width: 100%;
    border-collapse: collapse;
    border-radius: 14px;
    overflow: hidden;
  }

  th,
  td {
    border-bottom: 1px solid #2b2b2b;
    padding: 12px 10px;
    text-align: center;
  }

  th {
    background: #1f242b;
    color: #a9b3be;
  }

  tr:hover {
    background: rgba(255, 255, 255, 0.03);
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border: 1px solid #30363d;
    background: #1c2128;
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 0.9rem;
  }

  /* ====== Misc ====== */
  .hint {
    color: var(--sub);
    font-size: 0.9rem;
    margin-top: 4px;
  }

  .footer-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 6px;
  }

  .save-ind {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    color: #91ff9e;
    font-weight: 700;
    margin-top: 8px;
  }

  .hidden {
    display: none !important;
  }
</style>

  </style>
</head>
<body>
  <div class="container">

    <div class="card" id="headerCard">
      <h1>ğŸ“… ØµÙØ­Ø© Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ù€Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
      <p class="subtitle">Ø§Ù„ÙŠÙˆÙ…: <span id="todayLabel"></span> â€¢ Ø§Ù„ØªØ§Ø±ÙŠØ®: <span id="dateKey"></span></p>
      <p class="subtitle" id="clientNameWrap" style="margin-top:6px">
        <label style="margin-inline-start:6px">ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
        <input id="clientName" class="field" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù„Ø±Ø¨Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹" />
      </p>
      <div class="save-ind" id="saveInd" aria-live="polite" style="display:none">
        âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      </div>
    </div>

    <!-- Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„ÙˆØ¬Ø¨Ø§Øª -->
    <div class="card">
      <label class="title">ğŸ½ï¸ Ù‡Ù„ Ø§Ù„ØªØ²Ù…Øª Ø¨ÙƒÙ…ÙŠØ§Øª ÙˆØ£ÙˆØ²Ø§Ù† Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ø§Ù„ÙŠÙˆÙ…ØŸ</label>
      <div class="yn" data-group="meals_ok">
        <label class="chip ok"><input type="radio" name="meals_ok" value="Ù†Ø¹Ù…"><span>âœ… Ù†Ø¹Ù…</span></label>
        <label class="chip no"><input type="radio" name="meals_ok" value="Ù„Ø§"><span>âŒ Ù„Ø§</span></label>
      </div>
      <div id="meals_reason_wrap" class="hidden">
        <label class="title" style="margin-top:10px">ğŸ¤” Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label>
        <textarea id="meals_reason" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙØ± / ÙˆØ¬Ø¨Ø© Ø®Ø§Ø±Ø¬ÙŠØ© / Ù…Ø§ ØªÙˆÙØ± Ø§Ù„Ø£ÙƒÙ„"></textarea>
      </div>
    </div>

    <!-- Ø§Ù„Ù…Ø§Ø¡ -->
    <div class="card">
      <label class="title">ğŸ’§ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„ÙŠÙˆÙ…</label>
      <div class="water-box">
        <div class="row">
          <div class="water-stats">
            <div>
              <div class="hint">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
              <div class="big" id="waterLiters">0.00 Ù„ØªØ±</div>
            </div>
            <div>
              <div class="hint">Ø§Ù„Ù‡Ø¯Ù Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
              <select id="waterGoal" class="field">

                  <option value="2000">2.0 Ù„ØªØ±</option>
                  <option value="2500">2.5 Ù„ØªØ±</option>
                  <option value="3000" selected>3.0 Ù„ØªØ±</option>
                  <option value="3500">3.5 Ù„ØªØ±</option>
                  <option value="4000">4.0 Ù„ØªØ±</option>
                  <option value="5000">5.0 Ù„ØªØ±</option>
                  <option value="6000">6.0 Ù„ØªØ±</option>
                  <option value="7000">7.0 Ù„ØªØ±</option>
                  <option value="8000">8.0 Ù„ØªØ±</option>
                </select>

              </select>
            </div>
          </div>
          <div class="water-actions">
            <button class="btn" data-add="250">+ ÙƒÙˆØ¨ 250ml</button>
            <button class="btn" data-add="300">+ 300ml</button>
            <button class="btn" data-add="500">+ 500ml</button>
            <input id="customMl" class="field" inputmode="numeric" placeholder="Ø¥Ø¶Ø§ÙØ© ÙƒÙ…ÙŠØ© Ù…Ø®ØµØµØ© (ml)" style="flex:1 1 160px">
            <button class="btn sec" id="addCustom">Ø¥Ø¶Ø§ÙØ©</button>
            <button class="btn ghost" id="undoWater">â†©ï¸ ØªØ±Ø§Ø¬Ø¹</button>
            <button class="btn warn" id="resetWater">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
          </div>
        </div>
        <div class="progress" aria-label="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²"><div id="waterBar"></div></div>
        <div class="hint">âœ… ØªÙ‚Ø¯Ø± ØªØ¶ÙŠÙ Ø¹Ù„Ù‰ Ø¯ÙØ¹Ø§Øª Ø·ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…. ÙƒÙ„ ØªØºÙŠÙŠØ± Ù…Ø­ÙÙˆØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
      </div>
    </div>

    <!-- Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ -->
    <div class="card">
      <label class="title">ğŸƒâ€â™‚ï¸ Ù‡Ù„ Ø§Ù„ØªØ²Ù…Øª Ø¨Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ…ØŸ</label>
      <div class="yn" data-group="cardio_ok">
        <label class="chip ok"><input type="radio" name="cardio_ok" value="Ù†Ø¹Ù…"><span>âœ… Ù†Ø¹Ù…</span></label>
        <label class="chip no"><input type="radio" name="cardio_ok" value="Ù„Ø§"><span>âŒ Ù„Ø§</span></label>
      </div>
      <div id="cardio_more" class="hidden">
        <label class="title" for="cardio_mins">â±ï¸ Ù…Ø¯Ø© Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
        <input id="cardio_mins" type="number" min="0" class="field" placeholder="Ù…Ø«Ø§Ù„: 30">
      </div>
      <div id="cardio_reason_wrap" class="hidden">
        <label class="title">ğŸ¤” Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</label>
        <textarea id="cardio_reason" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ø¨Ø§Ø®ØªØµØ§Ø±"></textarea>
      </div>
    </div>

    <!-- Ø§Ù„ØªÙ…Ø±ÙŠÙ† -->
    <div class="card">
      <label class="title">ğŸ‹ï¸â€â™‚ï¸ Ù‡Ù„ Ù†ÙØ°Øª ØªÙ…Ø±ÙŠÙ†Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</label>
      <div class="yn" data-group="train_ok">
        <label class="chip ok"><input type="radio" name="train_ok" value="Ù†Ø¹Ù…"><span>âœ… Ù†Ø¹Ù…</span></label>
        <label class="chip no"><input type="radio" name="train_ok" value="Ù„Ø§"><span>âŒ Ù„Ø§</span></label>
      </div>
      <div id="train_more" class="hidden">
        <div class="row">
          <div>
            <label class="title" for="train_rate">ğŸ“ˆ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ (1â€“10)</label>
            <input id="train_rate" type="number" min="1" max="10" class="field" placeholder="Ù…Ø«Ø§Ù„: 8">
          </div>
          <div>
            <label class="title" for="train_note">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
            <input id="train_note" class="field" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙƒÙŠÙ ÙƒØ§Ù† Ø´Ø¹ÙˆØ±Ùƒ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŸ">
          </div>
        </div>
      </div>
      <div id="train_reason_wrap" class="hidden">
        <label class="title">ğŸ¤” Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø§Ù„ØªÙ…Ø±ÙŠÙ†</label>
        <textarea id="train_reason" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ø¨Ø§Ø®ØªØµØ§Ø±"></textarea>
      </div>
    </div>

    <!-- Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª -->
    <div class="card">
      <label class="title">ğŸ’Š Ù‡Ù„ Ø£Ø®Ø°Øª Ù…ÙƒÙ…Ù„Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ</label>
      <div class="yn" data-group="supp_ok">
        <label class="chip ok"><input type="radio" name="supp_ok" value="Ù†Ø¹Ù…"><span>âœ… Ù†Ø¹Ù…</span></label>
        <label class="chip no"><input type="radio" name="supp_ok" value="Ù„Ø§"><span>âŒ Ù„Ø§</span></label>
      </div>
      <div id="supp_reason_wrap" class="hidden">
        <label class="title">ğŸ¤” Ø³Ø¨Ø¨ Ø¹Ø¯Ù… Ø£Ø®Ø° Ø§Ù„Ù…ÙƒÙ…Ù„</label>
        <textarea id="supp_reason" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ø¨Ø§Ø®ØªØµØ§Ø±"></textarea>
      </div>
    </div>


    <!-- Ø§Ù„Ù†ÙˆÙ… ÙˆØ§Ù„ÙˆØ²Ù† -->
    <div class="card">
      <div class="row">
        <div>
          <label class="title" for="sleep_hours">ğŸ˜´ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ… (Ø§Ù„Ù„ÙŠÙ„Ø© Ø§Ù„Ù…Ø§Ø¶ÙŠØ©)</label>
          <input id="sleep_hours" type="number" min="0" step="0.5" class="field" placeholder="Ù…Ø«Ø§Ù„: 7.5">
        </div>
        <div>
          <label class="title" for="weight">âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ (ÙƒØº)</label>
          <input id="weight" type="number" min="0" step="0.1" class="field" placeholder="Ù…Ø«Ø§Ù„: 78.4">
        </div>
      </div>
    </div>

  <!-- Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙÙ‚Ø· -->
  <div class="card">
    <label class="title" for="notes" style="margin-top:10px">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„ÙŠÙˆÙ…</label>
    <textarea id="notes" placeholder="Ø£ÙŠ Ø´ÙŠØ¡ Ø¥Ø¶Ø§ÙÙŠ Ù…Ù‡Ù… Ø§Ù„ÙŠÙˆÙ…"></textarea>
  </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø³Ø¨ÙˆØ¹ / Ù†Ø³Ø® -->
    <div class="card">
      <div class="footer-actions">
        <button class="btn sec" id="showWeek">ğŸ“… Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
        <button class="btn ghost" id="copyWeek">ğŸ“‹ Ù†Ø³Ø® ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
        <button class="btn danger" id="resetWeek">ğŸ§¹ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
      </div>
      <p class="hint" style="text-align:center;margin-top:10px">ÙƒÙ„ Ø¥Ø¯Ø®Ø§Ù„ ÙŠØªÙ… Ø­ÙØ¸Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®. Ø¨Ø¥Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø© ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø¯ÙˆÙ† ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
    </div>

    <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ -->
    <div class="card hidden" id="weekCard">
      <h2 style="margin:0 0 12px;text-align:center">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h2>
      <div class="hint" id="weekRange" style="text-align:center;margin-bottom:10px"></div>
      <div class="badge" id="weekClientBadge" style="justify-content:center;margin-bottom:10px"></div>
      <div class="table-wrap">
        <table id="weekTable">
          <thead>
            <tr>
              <th>Ø§Ù„ÙŠÙˆÙ…</th>
              <th>Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</th>
              <th>Ø§Ù„Ù…Ø§Ø¡</th>
              <th>Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ</th>
              <th>Ø§Ù„ØªÙ…Ø±ÙŠÙ†</th>
              <th>Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª</th>
              <th>Ø§Ù„Ù†ÙˆÙ…</th>
              <th>Ø§Ù„ÙˆØ²Ù†</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

  </div>

  <script>
  // ===== Helpers =====
  const pad = n => String(n).padStart(2,'0');
  const toDateKey = (d=new Date()) => {
    // Ø­ÙØ¸ Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ù„ÙŠ (Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚ÙŠØª)
    const y = d.getFullYear();
    const m = pad(d.getMonth()+1);
    const day = pad(d.getDate());
    return `${y}-${m}-${day}`;
  }
  const prettyDate = (d) => d.toLocaleDateString('ar', { weekday:'long', year:'numeric', month:'long', day:'numeric' });

  const STORAGE_KEY='dt-entries-v1';
  const readAll=()=> JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}');
  const writeAll=(obj)=> localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));

  const today = new Date();
  const TODAY_KEY = toDateKey(today);

  // DOM refs
  const refs = {
    clientName: document.getElementById('clientName'),
    todayLabel: document.getElementById('todayLabel'),
    dateKey: document.getElementById('dateKey'),
    saveInd: document.getElementById('saveInd'),

    meals_ok: document.querySelectorAll('input[name="meals_ok"]'),
    meals_reason_wrap: document.getElementById('meals_reason_wrap'),
    meals_reason: document.getElementById('meals_reason'),

    waterLiters: document.getElementById('waterLiters'),
    waterBar: document.getElementById('waterBar'),
    waterGoal: document.getElementById('waterGoal'),
    addBtns: document.querySelectorAll('[data-add]'),
    customMl: document.getElementById('customMl'),
    addCustom: document.getElementById('addCustom'),
    resetWater: document.getElementById('resetWater'),
    undoWater: document.getElementById('undoWater'),

    cardio_ok: document.querySelectorAll('input[name="cardio_ok"]'),
    cardio_more: document.getElementById('cardio_more'),
    cardio_mins: document.getElementById('cardio_mins'),
    cardio_reason_wrap: document.getElementById('cardio_reason_wrap'),
    cardio_reason: document.getElementById('cardio_reason'),

    train_ok: document.querySelectorAll('input[name="train_ok"]'),
    train_more: document.getElementById('train_more'),
    train_rate: document.getElementById('train_rate'),
    train_note: document.getElementById('train_note'),
    train_reason_wrap: document.getElementById('train_reason_wrap'),
    train_reason: document.getElementById('train_reason'),

    supp_ok: document.querySelectorAll('input[name="supp_ok"]'),
    supp_more: document.getElementById('supp_more'),
    supp_list: document.getElementById('supp_list'),
    supp_reason_wrap: document.getElementById('supp_reason_wrap'),
    supp_reason: document.getElementById('supp_reason'),

    sleep_hours: document.getElementById('sleep_hours'),
    weight: document.getElementById('weight'),


    notes: document.getElementById('notes'),

    showWeek: document.getElementById('showWeek'),
    copyWeek: document.getElementById('copyWeek'),
    resetWeek: document.getElementById('resetWeek'),

    weekCard: document.getElementById('weekCard'),
    weekTableBody: document.querySelector('#weekTable tbody'),
    weekRange: document.getElementById('weekRange'),
    weekClientBadge: document.getElementById('weekClientBadge')
  };

  // ===== State =====
  let entries = readAll();
  if(!entries[TODAY_KEY]) entries[TODAY_KEY] = defaultEntry();
  let waterUndoStack = []; // for undo

function defaultEntry(){
  return {
    clientName: '',
    meals_ok: '', meals_reason:'',
    water_ml: 0, water_goal: 3000,
    cardio_ok:'', cardio_mins:'', cardio_reason:'',
    train_ok:'', train_rate:'', train_note:'', train_reason:'',
    supp_ok:'', supp_reason:'',
    sleep_hours:'', weight:'',
    notes:''
  }
}


  function showSaved(){
    refs.saveInd.style.display='block';
    clearTimeout(showSaved._t); showSaved._t=setTimeout(()=>{refs.saveInd.style.display='none'}, 1200);
  }

  function save(){
    writeAll(entries); showSaved();
  }

  // ===== UI init =====
  refs.todayLabel.textContent = prettyDate(today);
  refs.dateKey.textContent = TODAY_KEY;

  // load today's entry
  function loadToday(){
    const e = entries[TODAY_KEY] || defaultEntry();
    // client name
    refs.clientName.value = e.clientName || '';

    // meals
    checkRadio('meals_ok', e.meals_ok);
    refs.meals_reason.value = e.meals_reason || '';
    toggle(refs.meals_reason_wrap, e.meals_ok==='Ù„Ø§');

    // water
    refs.waterGoal.value = String(e.water_goal||3000);
    updateWaterUI(e.water_ml || 0);

    // cardio
    checkRadio('cardio_ok', e.cardio_ok);
    refs.cardio_mins.value = e.cardio_mins || '';
    refs.cardio_reason.value = e.cardio_reason || '';
    toggle(refs.cardio_more, e.cardio_ok==='Ù†Ø¹Ù…');
    toggle(refs.cardio_reason_wrap, e.cardio_ok==='Ù„Ø§');

    // train
    checkRadio('train_ok', e.train_ok);
    refs.train_rate.value = e.train_rate || '';
    refs.train_note.value = e.train_note || '';
    refs.train_reason.value = e.train_reason || '';
    toggle(refs.train_more, e.train_ok==='Ù†Ø¹Ù…');
    toggle(refs.train_reason_wrap, e.train_ok==='Ù„Ø§');

    // supp
    checkRadio('supp_ok', e.supp_ok);
    toggle(refs.supp_more, e.supp_ok==='Ù†Ø¹Ù…');
    toggle(refs.supp_reason_wrap, e.supp_ok==='Ù„Ø§');
    // set checked supplements
    [...refs.supp_list.querySelectorAll('input[type="checkbox"]')].forEach(c=>{
      c.checked = (e.supp_list||[]).includes(c.value);
    })

    // sleep weight
    refs.sleep_hours.value = e.sleep_hours || '';
    refs.weight.value = e.weight || '';



    // notes
    refs.notes.value = e.notes || '';
  }

  function toggle(el, show){ el.classList[show? 'remove':'add']('hidden'); }
  function checkRadio(name, val){
    const radios = document.querySelectorAll(`input[name="${name}"]`);
    radios.forEach(r=>{ r.checked = (r.value===val); });
  }

  function getToday(){ return entries[TODAY_KEY] || (entries[TODAY_KEY]=defaultEntry()); }

  function updateWaterUI(ml){
    const goal = +refs.waterGoal.value || 3000;
    const liters = (ml/1000).toFixed(2);
    refs.waterLiters.textContent = `${liters} Ù„ØªØ±`;
    const pct = Math.min(100, Math.round((ml/goal)*100));
    refs.waterBar.style.width = pct + '%';
  }

  // ===== Event bindings & autosave =====
  function bindYN(group, onChange){
    document.querySelectorAll(`[data-group="${group}"] input[type=radio]`).forEach(r=>{
      r.addEventListener('change', ()=>{
        const e = getToday();
        e[group] = r.value;
        onChange && onChange(r.value, e);
        save();
      });
    });
  }

  refs.clientName.addEventListener('input',()=>{ getToday().clientName = refs.clientName.value.trim(); save(); });

  // meals
  bindYN('meals_ok', (v)=>{ toggle(refs.meals_reason_wrap, v==='Ù„Ø§'); });
  refs.meals_reason.addEventListener('input',()=>{ getToday().meals_reason = refs.meals_reason.value.trim(); save(); });

  // water buttons
  refs.addBtns.forEach(btn=>{
    btn.addEventListener('click',()=>{
      const add = +btn.dataset.add;
      const e = getToday();
      waterUndoStack.push(e.water_ml||0);
      e.water_ml = (e.water_ml||0) + add;
      updateWaterUI(e.water_ml); save();
    })
  });
  refs.addCustom.addEventListener('click',()=>{
    const val = parseInt(refs.customMl.value||'0',10);
    if(!isNaN(val) && val>0){
      const e = getToday();
      waterUndoStack.push(e.water_ml||0);
      e.water_ml = (e.water_ml||0) + val;
      updateWaterUI(e.water_ml); save();
      refs.customMl.value='';
    }
  });
  refs.undoWater.addEventListener('click',()=>{
    if(waterUndoStack.length){
      const prev = waterUndoStack.pop();
      const e = getToday(); e.water_ml = prev; updateWaterUI(e.water_ml); save();
    }
  });
  refs.resetWater.addEventListener('click',()=>{
    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø§Ø¡ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…ØŸ')){
      const e = getToday(); e.water_ml = 0; waterUndoStack=[]; updateWaterUI(0); save();
    }
  });
  refs.waterGoal.addEventListener('change',()=>{ getToday().water_goal = +refs.waterGoal.value; updateWaterUI(getToday().water_ml||0); save(); })

  // cardio
  bindYN('cardio_ok', (v)=>{ toggle(refs.cardio_more, v==='Ù†Ø¹Ù…'); toggle(refs.cardio_reason_wrap, v==='Ù„Ø§'); });
  refs.cardio_mins.addEventListener('input',()=>{ getToday().cardio_mins = refs.cardio_mins.value; save(); });
  refs.cardio_reason.addEventListener('input',()=>{ getToday().cardio_reason = refs.cardio_reason.value.trim(); save(); });

  // train
  bindYN('train_ok', (v)=>{ toggle(refs.train_more, v==='Ù†Ø¹Ù…'); toggle(refs.train_reason_wrap, v==='Ù„Ø§'); });
  refs.train_rate.addEventListener('input',()=>{ const v=refs.train_rate.value; getToday().train_rate = v; save(); });
  refs.train_note.addEventListener('input',()=>{ getToday().train_note = refs.train_note.value.trim(); save(); });
  refs.train_reason.addEventListener('input',()=>{ getToday().train_reason = refs.train_reason.value.trim(); save(); });

  // supp
  bindYN('supp_ok', (v)=>{ toggle(refs.supp_more, v==='Ù†Ø¹Ù…'); toggle(refs.supp_reason_wrap, v==='Ù„Ø§'); });

  refs.supp_reason.addEventListener('input',()=>{ getToday().supp_reason = refs.supp_reason.value.trim(); save(); });

  // sleep & weight
  refs.sleep_hours.addEventListener('input',()=>{ getToday().sleep_hours = refs.sleep_hours.value; save(); });
  refs.weight.addEventListener('input',()=>{ getToday().weight = refs.weight.value; save(); });

  // notes ÙÙ‚Ø·
  refs.notes.addEventListener('input',()=>{ getToday().notes = refs.notes.value.trim(); save(); });


  // ===== Weekly summary =====
  function getLast7Keys(){
    const arr=[]; const d=new Date();
    for(let i=0;i<7;i++){
      const di = new Date(d.getFullYear(), d.getMonth(), d.getDate()-i);
      arr.push({key: toDateKey(di), date: di});
    }
    return arr.reverse();
  }

function weekSummaryText(keys){
  const eAll = readAll();
  const lines = [];
  const name = (eAll[TODAY_KEY]?.clientName || '').trim();
  lines.push(`ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ${name?` â€” ${name}`:''}`);
  lines.push('');

  keys.forEach(({key, date})=>{
    const e = eAll[key] || {};
    const dayTitle = date.toLocaleDateString('ar', { weekday:'long', month:'short', day:'numeric' });
    const waterL = ((e.water_ml||0)/1000).toFixed(2);

    // âœ… ØªØ¹Ø¯ÙŠÙ„ Ù‚Ø³Ù… Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª Ù„ÙŠÙƒÙˆÙ† Ø¨Ø³ÙŠØ· ÙˆÙˆØ§Ø¶Ø­
    const supp = e.supp_ok === 'Ù†Ø¹Ù…'
      ? 'âœ… ØªÙ… Ø£Ø®Ø° Ø§Ù„Ù…ÙƒÙ…Ù„'
      : (e.supp_ok === 'Ù„Ø§'
          ? (e.supp_reason ? `âŒ Ù„Ù… ÙŠØ¤Ø®Ø° (${e.supp_reason})` : 'âŒ Ù„Ù… ÙŠØ¤Ø®Ø°')
          : 'â€”');

    lines.push(`â€” ${dayTitle} (${key})`);
    lines.push(`  â€¢ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª: ${e.meals_ok||'â€”'}${e.meals_ok==='Ù„Ø§'&&e.meals_reason?` â€” Ø§Ù„Ø³Ø¨Ø¨: ${e.meals_reason}`:''}`);
    lines.push(`  â€¢ Ø§Ù„Ù…Ø§Ø¡: ${waterL} Ù„ØªØ± Ù…Ù† Ù‡Ø¯Ù ${(e.water_goal||3000)/1000} Ù„ØªØ±`);
    lines.push(`  â€¢ Ø§Ù„ÙƒØ§Ø±Ø¯ÙŠÙˆ: ${e.cardio_ok||'â€”'}${e.cardio_ok==='Ù†Ø¹Ù…'&&e.cardio_mins?` (${e.cardio_mins} Ø¯)`:''}${e.cardio_ok==='Ù„Ø§'&&e.cardio_reason?` â€” Ø§Ù„Ø³Ø¨Ø¨: ${e.cardio_reason}`:''}`);
    lines.push(`  â€¢ Ø§Ù„ØªÙ…Ø±ÙŠÙ†: ${e.train_ok||'â€”'}${e.train_ok==='Ù†Ø¹Ù…'&&e.train_rate?` â€” ØªÙ‚ÙŠÙŠÙ… ${e.train_rate}/10`:''}${e.train_ok==='Ù„Ø§'&&e.train_reason?` â€” Ø§Ù„Ø³Ø¨Ø¨: ${e.train_reason}`:''}`);

    // âœ… Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‡Ùˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„ØµØ­ÙŠØ­
    lines.push(`  â€¢ Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª: ${supp}`);

    lines.push(`  â€¢ Ø§Ù„Ù†ÙˆÙ…: ${e.sleep_hours?`${e.sleep_hours} Ø³`:'â€”'}`);
    lines.push(`  â€¢ Ø§Ù„ÙˆØ²Ù†: ${e.weight?`${e.weight} ÙƒØº`:'â€”'}`);
    if(e.notes) lines.push(`  â€¢ Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${e.notes}`);
    lines.push('');
  });

  return lines.join('\n');
}


  function renderWeek(){
    const keys = getLast7Keys();
    const eAll = readAll();

    // header
    const first = keys[0].date, last = keys[keys.length-1].date;
    refs.weekRange.textContent = `Ù…Ù† ${first.toLocaleDateString('ar',{month:'long',day:'numeric'})} Ø¥Ù„Ù‰ ${last.toLocaleDateString('ar',{month:'long',day:'numeric'})}`;

    const name = (eAll[TODAY_KEY]?.clientName || '').trim();
    refs.weekClientBadge.textContent = name? `ğŸ‘¤ ${name}` : '';
    refs.weekClientBadge.style.display = name? 'inline-flex':'none';

    // table
    refs.weekTableBody.innerHTML='';
    keys.forEach(({key, date})=>{
      const e = eAll[key] || {};
      const tr = document.createElement('tr');
      const dayName = date.toLocaleDateString('ar', { weekday:'short' });
      const water = ((e.water_ml||0)/1000).toFixed(2)+ ' Ù„ØªØ±';
      const supp = e.supp_ok === 'Ù†Ø¹Ù…'
        ? 'âœ… Ù†Ø¹Ù…'
        : (e.supp_ok === 'Ù„Ø§'
            ? (e.supp_reason ? `âŒ Ù„Ø§ (${e.supp_reason})` : 'âŒ Ù„Ø§')
            : 'â€”');

      tr.innerHTML = `
        <td><div class="badge">${dayName} <span style="opacity:.65">${key}</span></div></td>
        <td>${e.meals_ok||'â€”'}</td>
        <td>${water}</td>
        <td>${e.cardio_ok||'â€”'} ${e.cardio_ok==='Ù†Ø¹Ù…'&&e.cardio_mins?`(${e.cardio_mins} Ø¯)`:''}</td>
        <td>${e.train_ok||'â€”'} ${e.train_ok==='Ù†Ø¹Ù…'&&e.train_rate?`(${e.train_rate}/10)`:''}</td>
        <td>${supp}</td>
        <td>${e.sleep_hours||'â€”'} Ø³</td>
        <td>${e.weight||'â€”'} ÙƒØº</td>
      `;

      refs.weekTableBody.appendChild(tr);
    });

    toggle(refs.weekCard, true);
  }

  refs.showWeek.addEventListener('click', ()=>{ renderWeek(); window.scrollTo({top: document.body.scrollHeight, behavior:'smooth'}); });

  refs.copyWeek.addEventListener('click', async ()=>{
    const txt = weekSummaryText(getLast7Keys());
    try{ await navigator.clipboard.writeText(txt); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ â€” ÙŠÙ…ÙƒÙ†Ùƒ Ù„ØµÙ‚Ù‡ Ø§Ù„Ø¢Ù†'); }
    catch{
      const ta=document.createElement('textarea'); ta.value=txt; ta.style.position='fixed'; ta.style.opacity='0'; document.body.appendChild(ta); ta.focus(); ta.select();
      try{ document.execCommand('copy'); alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ'); }catch{ alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ ÙˆÙ†Ø³Ø®Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§'); }
      document.body.removeChild(ta);
    }
  });

  refs.resetWeek.addEventListener('click',()=>{
    if(confirm('ØªÙ†Ø¨ÙŠÙ‡: Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ù„Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù… Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø². Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')){
      const all = readAll();
      getLast7Keys().forEach(({key})=>{ delete all[key]; });
      writeAll(all); entries = all; if(!entries[TODAY_KEY]) entries[TODAY_KEY]=defaultEntry(); loadToday(); toggle(refs.weekCard,false); showSaved();
    }
  })

  // init
  loadToday();
  </script>
</body>
</html>
